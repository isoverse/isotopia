<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Sebastian Kopf" />

<meta name="date" content="2016-05-31" />

<title>Introduction</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>


<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div class="fluid-row" id="header">


<h1 class="title">Introduction</h1>
<h4 class="author"><em>Sebastian Kopf</em></h4>
<h4 class="date"><em>2016-05-31</em></h4>

</div>


<div id="isotopia" class="section level1">
<h1><a href="https://github.com/sebkopf/isotopia">isotopia</a></h1>
<p>In stable isotope geochemical calculations, we use a number of different representations of isotopic information and processes (ratios, abundances, delta values, alpha values, epsilon values, fractionation factors, refereence frame shifts, mass balance calculations, mass-independent effects, etc., etc.) that are constantly being converted back and forth and used for different kinds of isotope arithmetic. Very frequently, the tangle of keeping track of this information and how all the calculations are done properly makes code very hard to read, difficult to communicate - or even understand oneself later on, and as anyone knows who’s ever dropped a -1 or x1000 at the wrong place, prone to small mistakes that can make an enormous difference.</p>
<p>The <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> package uses the S4 object system of R to define elemental isotopic data classes so that it can automatically keep track of what is a ratio, what is a delta value (and is it in permil notation or in ppm), etc., and perform isotope arithmetic accordingly. The multiple dispatch system of S4 allows any generic function to be dispached to a method based on the class of the argument, i.e. a fractionation function can be implemented differentely whether it is supposed to fractionate an isotope ratio or a delta value. This allows the user to focus on the actual calculations and communicate to the reader exactly what each value represents. Most importantly, the isotope value object structure allows <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> to put safeguards in place against non-sense calculations and makes it easy to implement rigorous, automatically executed tests (Wickham, 2011) for every single formula and computation (currently there are over 350 tests implemented, see <a href="#testing">Testing</a> for a few examples). This means that any time any of the isotopia source code is modified, it has to pass all the tests that ensure it is functioning exactly as expected. This kind of test-driven implementation provides high confidence in the calculations and protects from small code changes leading to incorrect results and interpretation.</p>
<p>The <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> module thus provides several isotopic data types that can be initialized by calling the respective <code>ratio</code>, <code>abundance</code>, <code>delta</code>, <code>fractionation_factor</code> and <code>intensity</code> functions. Each data type has additional attributes (such as name of the minor and major isotopes, and what compound it represents, what the reference ratio is for delta values, and what notation is used), which are all described in great detail in the help functions of <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> that are accessible directly from R. Each data type can be initialized as a single vector of isotopic data or an entire system of isotope values for the same element (e.g. all oxygen or all sulfur isotopes). As all isotope data objects are implemented as extensions of primitive data types in R, they can be structured and aggregated in all the ways familiar to people with prior R experience, but should be intuitive enough to be useful “out of the box” for users new to this language. Isotope data types can then be converted from one type to another using <code>to_ratio</code>, <code>to_abundance</code>, <code>to_delta</code>, <code>to_fractionation_factor</code> methods, can be used in operations (<code>mass_balance</code>, <code>fractionation</code>, etc.) or transferred from one notation to another using switch_notation. Here, I provide a few examples how <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> works and how it can be used, with the complete documentation available in the reference manual.</p>
<div id="installation" class="section level2">
<h2>Installation</h2>
<p>The <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> R module can be installed directly from <a href="https://github.com/">GitHub</a>, by using the R development tools module (Wickham and Chang, 2014). A word of caution that isotopia is still under active development and development versions include additional functionality with syntax that might not be backwards compatible. This tutorial is available <a href="vignettes/isotopia.Rmd">directly in this repository</a> including the resulting <a href="https://rawgit.com/sebkopf/isotopia/master/inst/doc/isotopia.html">HTML output</a>, and also as a vignette directly in the package and will be updated as new versions are released. Please use the <a href="https://github.com/sebkopf/isotopia/issues">Issue Tracker</a> to report any problems, bugs or feature requests.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">'devtools'</span>, <span class="dt">depen=</span>T) 
devtools::<span class="kw">install_github</span>(<span class="st">&quot;sebkopf/isotopia&quot;</span>, <span class="dt">build_vignettes =</span> T)</code></pre></div>
<p>To look at the newest version of this tutorial directly within R, call the vignette:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">vignette</span>(<span class="st">&quot;isotopia&quot;</span>)</code></pre></div>
</div>
<div id="data-types" class="section level2">
<h2>Data types</h2>
<p>After <em>isotopia</em> is installed, it can be loaded at any time like any other R module using <code>library(isotopia)</code>. The basic data types are initialized simply by calling the respective <code>ratio</code>, <code>abundance</code>, <code>delta</code> and <code>fractionation_factor</code> functions with single or multiple values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(isotopia)
<span class="kw">show</span>(<span class="kw">ratio</span>(<span class="fl">0.1</span>)) </code></pre></div>
<pre><code>## An isotope value object of type 'Ratio value': R 13C/12C
## [1] 0.1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">show</span>(<span class="kw">abundance</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>))) </code></pre></div>
<pre><code>## An isotope value object of type 'Abundance value': F 13C
## [1] 0.1 0.2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">show</span>(<span class="kw">delta</span>(<span class="dv">100</span>, <span class="dt">notation =</span> <span class="st">&quot;permil&quot;</span>)) </code></pre></div>
<pre><code>## An isotope value object of type 'Delta value': d13C [permil]
## [1] 100</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">show</span>(<span class="kw">fractionation_factor</span>(<span class="kw">seq</span>(<span class="fl">0.97</span>, <span class="fl">1.03</span>, <span class="dt">by=</span><span class="fl">0.01</span>), <span class="dt">notation =</span> <span class="st">&quot;alpha&quot;</span>))</code></pre></div>
<pre><code>## An isotope value object of type 'FractionationFactor value': 13C alpha
## [1] 0.97 0.98 0.99 1.00 1.01 1.02 1.03</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">show</span>(<span class="kw">intensity</span>(<span class="dv">100</span>, <span class="dt">unit =</span> <span class="st">&quot;mV&quot;</span>))</code></pre></div>
<pre><code>## An isotope value object of type 'Intensity value': 13C [mV]
## [1] 100</code></pre>
<div id="attributes" class="section level4">
<h4>Attributes</h4>
<p>All data types have certain attributes that are stored with the data values. For example, an isotope ratio can specify what minor and major isotope it represents and what compound it belongs to.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">show</span>(<span class="kw">ratio</span>(<span class="st">`</span><span class="dt">13C</span><span class="st">`</span> =<span class="st"> </span><span class="fl">0.011</span>, <span class="dt">major =</span> <span class="st">&quot;12C&quot;</span>, <span class="dt">compound =</span> <span class="st">&quot;CO2&quot;</span>))</code></pre></div>
<pre><code>## An isotope value object of type 'Ratio value': CO2 R 13C/12C
## [1] 0.011</code></pre>
<p>And a fractionation factor, for example, can additionally describe what the two reservoirs are between which it fractionates (introducing the shortcut ff instead of the identical long version fractionation_factor in the following).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">show</span>(<span class="kw">ff</span>(<span class="st">`</span><span class="dt">13C</span><span class="st">`</span> =<span class="st"> </span><span class="fl">0.995</span>,  <span class="dt">major =</span> <span class="st">&quot;12C&quot;</span>, <span class="dt">ctop =</span> <span class="st">&quot;CO2&quot;</span>, <span class="dt">cbot =</span> <span class="st">&quot;DIC&quot;</span>))</code></pre></div>
<pre><code>## An isotope value object of type 'FractionationFactor value': 13C alpha_CO2/DIC
## [1] 0.995</code></pre>
<p>All attributes can also be changed on an already initialized object using the set_attrib() function. However, changing previously defined attributes will always trigger a warning to alert the user to the fact that they are overwriting an attribute.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r &lt;-<span class="st"> </span><span class="kw">ratio</span>(<span class="st">`</span><span class="dt">18O</span><span class="st">`</span> =<span class="st"> </span><span class="fl">0.002</span>, <span class="dt">major =</span> <span class="st">&quot;16O&quot;</span>, <span class="dt">compound =</span> <span class="st">&quot;CO2&quot;</span>) 
r &lt;-<span class="st"> </span><span class="kw">set_attrib</span>(r, <span class="dt">minor =</span> <span class="st">&quot;17O&quot;</span>)</code></pre></div>
<pre><code>## Warning: changing the isotope name ('Ratio value' object) from '18O' to
## '17O'</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">show</span>(r)</code></pre></div>
<pre><code>## An isotope value object of type 'Ratio value': CO2 R 17O/16O
## [1] 0.002</code></pre>
<p>There are also a large number of safeguards in place that trigger errors if non-sensical isotope values are initialized (for example a negative isotope ratio or alpha fractionation factor).</p>
</div>
<div id="isotope-systems" class="section level4">
<h4>Isotope systems</h4>
<p>Entire isotope systems can be initialized in identical ways, by simply passing several separate values (or entire sequences of values) to the initialization functions (introducing the shortcut ab instead of the identical long version abundance in the following).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">show</span>(<span class="kw">ab</span>(<span class="st">`</span><span class="dt">33S</span><span class="st">`</span> =<span class="st"> </span><span class="fl">0.0075</span>, <span class="st">`</span><span class="dt">34S</span><span class="st">`</span> =<span class="st"> </span><span class="fl">0.0421</span>, <span class="st">`</span><span class="dt">36S</span><span class="st">`</span> =<span class="st"> </span><span class="fl">0.0002</span>, <span class="dt">major =</span> <span class="st">&quot;32S&quot;</span>))</code></pre></div>
<pre><code>## An isotope system object of type 'Abundances' with F 33S, F 34S, F 36S
##      33S    34S   36S
## 1 0.0075 0.0421 2e-04</code></pre>
</div>
</div>
<div id="notation" class="section level2">
<h2>Notation</h2>
<p>Closely related to the attributes system is the notation system implemented in <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a>. Notation is special because it is an attribute that, when changed, also changes the numerical value of an isotope object with it. All isotope value objects keep track internally what notation they are in, which allows them to be used correctly in any operations and conversions completely independent of what notation the user prefers to work in. Notation is first specified when an isotope value object is initialized and several different notations are implemented for the different isotope value objects. If not specified during intialization, <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> assumes tha an object is created with its default notation. A number of default settings can be specified and retrieved using <code>set_iso_opts()</code> and <code>get_iso_opts()</code>. Here an example of checking and setting the default notation for fractionation factors (which can be either <span class="math inline">\(\alpha\)</span> values, raw <span class="math inline">\(\epsilon=\alpha-1\)</span> or <span class="math inline">\(\epsilon\)</span> values in permil notation), initializing a new object with default notation (i.e. without specifying notation=“x”&quot; during initialization) and converting it back and forth.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">show</span>(<span class="kw">get_iso_opts</span>(<span class="st">&quot;default_ff_notation&quot;</span>)) </code></pre></div>
<pre><code>## [1] &quot;alpha&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">show</span>(<span class="kw">ff</span>(<span class="fl">1.02</span>)) <span class="co"># alpha notation </span></code></pre></div>
<pre><code>## An isotope value object of type 'FractionationFactor value': 13C alpha
## [1] 1.02</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set_iso_opts</span>(<span class="dt">default_ff_notation =</span> <span class="st">&quot;permil&quot;</span>) 
<span class="kw">show</span>(p &lt;-<span class="st"> </span><span class="kw">ff</span>(<span class="dv">20</span>))  <span class="co"># permil notation </span></code></pre></div>
<pre><code>## An isotope value object of type 'FractionationFactor value': 13C eps [permil]
## [1] 20</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">show</span>(<span class="kw">switch_notation</span>(p, <span class="st">&quot;eps&quot;</span>)) </code></pre></div>
<pre><code>## An isotope value object of type 'FractionationFactor value': 13C eps
## [1] 0.02</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">show</span>(<span class="kw">switch_notation</span>(p, <span class="st">&quot;alpha&quot;</span>))</code></pre></div>
<pre><code>## An isotope value object of type 'FractionationFactor value': 13C alpha
## [1] 1.02</code></pre>
<p>It is important to note that of course all of these values are equivalent, they are just representions of the same fractionation factor in different notation. Accordingly, they behave <strong>exactly</strong> the same in all calculations implemented by <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> regardless what notation they are in.</p>
</div>
<div id="conversions" class="section level2">
<h2>Conversions</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">i &lt;-<span class="st"> </span><span class="kw">intensity</span>(<span class="st">`</span><span class="dt">32S</span><span class="st">`</span> =<span class="st"> </span><span class="dv">9502</span>, <span class="st">`</span><span class="dt">33S</span><span class="st">`</span> =<span class="st"> </span><span class="dv">75</span>, <span class="st">`</span><span class="dt">34S</span><span class="st">`</span> =<span class="st"> </span><span class="dv">421</span>, <span class="st">`</span><span class="dt">36S</span><span class="st">`</span> =<span class="st"> </span><span class="dv">2</span>, 
               <span class="dt">major =</span> <span class="st">&quot;32S&quot;</span>, <span class="dt">unit =</span> <span class="st">&quot;#&quot;</span>)
<span class="kw">show</span>(i)</code></pre></div>
<pre><code>## An isotope system object of type 'Intensities' with 32S [#], 33S [#], 34S [#], 36S [#]
##    32S 33S 34S 36S
## 1 9502  75 421   2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r &lt;-<span class="st"> </span><span class="kw">to_ratio</span>(i)
<span class="kw">show</span>(r)</code></pre></div>
<pre><code>## An isotope system object of type 'Ratios' with R 33S/32S, R 34S/32S, R 36S/32S
##           33S        34S         36S
## 1 0.007893075 0.04430646 0.000210482</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ab &lt;-<span class="st"> </span><span class="kw">to_abundance</span>(r)
<span class="kw">show</span>(ab)</code></pre></div>
<pre><code>## An isotope system object of type 'Abundances' with F 33S, F 34S, F 36S
##      33S    34S   36S
## 1 0.0075 0.0421 2e-04</code></pre>
<p>Because the system of intensities (here as ion counts #) had the major isotope attribute specified, the conversion <code>to_ratio</code> could automatically figure out what ratios to form. Without specifying which one is the major isotope, the intensities would have still initialized just fine but <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> would have thrown an error when trying to convert to isotope ratios. There’s much more functionality in the conversions, which are all listed in the reference manual available directly within R by calling <code>?isotopia</code> or <code>?to_ratio</code> or any other function defined in the module.</p>
<div id="delta-values-and-reference-standards" class="section level3">
<h3>Delta values and reference standards</h3>
<p>In the case of delta values, conversions often require the specification or use of a reference ratio. This can simply be done by specifying the reference ratio when converting to_delta and since <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> stores the reference ratio with the delta value object, it can be used automatically in the reverse calculation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r &lt;-<span class="st"> </span><span class="kw">ratio</span>(<span class="st">`</span><span class="dt">13C</span><span class="st">`</span> =<span class="st"> </span><span class="fl">0.0115</span>, <span class="dt">major =</span> <span class="st">&quot;12C&quot;</span>)
ref_r &lt;-<span class="st"> </span><span class="kw">ratio</span>(<span class="st">`</span><span class="dt">13C</span><span class="st">`</span> =<span class="st"> </span><span class="fl">0.011237</span>, <span class="dt">major =</span> <span class="st">&quot;12C&quot;</span>, <span class="dt">compound =</span> <span class="st">&quot;VPDB&quot;</span>)
d &lt;-<span class="st"> </span><span class="kw">to_delta</span>(r, <span class="dt">ref_ratio =</span> ref_r)
<span class="kw">show</span>(d)</code></pre></div>
<pre><code>## An isotope value object of type 'Delta value': d13C [permil] vs. VPDB
## [1] 23.40482</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">show</span>(<span class="kw">to_ratio</span>(d))</code></pre></div>
<pre><code>## An isotope value object of type 'Ratio value': R 13C/12C
## [1] 0.0115</code></pre>
<p>Additionally, <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> keeps a register of known reference materials with several default values already entered and the possibility for the user to add additional ones they want to use (with the <code>register_standard()</code> function). Standards can be retrieved as ratio objects by calling <code>get_standard()</code> and specifying which standard to retrieve for which isotope (see the manual in section A.2.8 for details). The list of all registered ratios can be retrieved as any other option with a call to <code>get_iso_opts</code> (here turned into a table with the k-table or <code>kable</code> command provided by the knitr module - Xie, 2013):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(knitr)
<span class="kw">kable</span>(<span class="kw">get_iso_opts</span>(<span class="st">&quot;standards&quot;</span>), <span class="dt">format=</span><span class="st">&quot;markdown&quot;</span>)</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">minor</th>
<th align="left">major</th>
<th align="left">name</th>
<th align="right">ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2H</td>
<td align="left">1H</td>
<td align="left">VSMOW</td>
<td align="right">0.0001558</td>
</tr>
<tr class="even">
<td align="left">13C</td>
<td align="left">12C</td>
<td align="left">VPDB</td>
<td align="right">0.0112370</td>
</tr>
<tr class="odd">
<td align="left">15N</td>
<td align="left">14N</td>
<td align="left">Air</td>
<td align="right">0.0036770</td>
</tr>
<tr class="even">
<td align="left">18O</td>
<td align="left">16O</td>
<td align="left">VSMOW</td>
<td align="right">0.0020052</td>
</tr>
<tr class="odd">
<td align="left">34S</td>
<td align="left">32S</td>
<td align="left">CDT</td>
<td align="right">0.0045005</td>
</tr>
</tbody>
</table>
<p>Registered standards provide <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> with the means to automatically select the correct reference ratio during conversions with delta objects that have sufficiently specific attributes (a message informs the user what was selected, if not enough information is provided to match exactly to one correct standard, this will fail with an error unless the user specifically provides a reference ratio for the conversion).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">delta</span>(<span class="st">`</span><span class="dt">2H</span><span class="st">`</span> =<span class="st"> </span><span class="dv">100</span>, <span class="dt">major =</span> <span class="st">&quot;1H&quot;</span>, <span class="dt">ref =</span> <span class="st">&quot;VSMOW&quot;</span>)
<span class="kw">show</span>(d)</code></pre></div>
<pre><code>## An isotope value object of type 'Delta value': d2H [permil] vs. VSMOW
## [1] 100</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">show</span>(<span class="kw">to_ratio</span>(d))</code></pre></div>
<pre><code>## Warning: changing the isotope name ('Ratio value' object) from '13C' to
## '2H'</code></pre>
<pre><code>## Warning: changing the major isotope ('Ratio value' object) from '12C' to
## '1H'</code></pre>
<pre><code>## Successfully found a registered standard to convert delta value: VSMOW R 2H/1H: 0.0001558</code></pre>
<pre><code>## An isotope value object of type 'Ratio value': R 2H/1H
## [1] 0.000171325</code></pre>
</div>
</div>
<div id="operations" class="section level2">
<h2>Operations</h2>
<p>With the conversions and data types all in place, <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> can easily expand its func- tionality by building on top of the data types. Currently, operations are limited to a number of key features, such as <code>mass_balance()</code> calculations for fractional abundances and delta values, as well as fractionating (<code>fractionate()</code>) isotope data objects with <code>fractionation_factors</code> and shifting the reference frame on delta values (<code>shift_reference()</code>). As always, attributes are carried through these operations in the most sensible way for what they actuallly represent.</p>
<div id="mass-balance" class="section level3">
<h3>Mass balance</h3>
<p>Mass balance makes use of an additional attribute not mentioned before, the weight attribute. This allows one to weight values according to their reservoir sizes such that during mass balance calculations, isotopically different pools are mixed according to their relative proportions. Weight can be specified either during initialization or by using the <code>weight()</code> function later on. Imagine a reservoir of CO2 that receives a tiny spike of heavily labeled additional carbon. For convenience, we’re introducing here the <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> options to set the default minor and major isotope names - this is nice for working on a problem in a specific isotope system. Also, we’re going to do the mass balance exact by converting to fractional abundances (although <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> provides the approximate <code>mass_balance()</code> directly with delta value objects as well).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set_iso_opts</span>(
    <span class="dt">default_minor =</span> <span class="st">&quot;13C&quot;</span>, 
    <span class="dt">default_major=</span><span class="st">&quot;12C&quot;</span>,
    <span class="dt">default_ab_notation =</span> <span class="st">&quot;percent&quot;</span>)
res &lt;-<span class="st"> </span><span class="kw">delta</span>(-<span class="dv">10</span>, <span class="dt">compound =</span> <span class="st">&quot;CO2&quot;</span>, <span class="dt">ref =</span> <span class="st">&quot;VPDB&quot;</span>, <span class="dt">weight =</span> <span class="dv">100</span>)
<span class="kw">show</span>(res)</code></pre></div>
<pre><code>## A weighted isotope value object of type 'Delta value': CO2 d13C [permil] vs. VPDB
##   value weight
## 1   -10    100</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">spike &lt;-<span class="st"> </span><span class="kw">ab</span>(<span class="kw">seq</span>(<span class="dv">5</span>, <span class="dv">25</span>, <span class="dt">by =</span> <span class="dv">5</span>), <span class="dt">compound =</span> <span class="st">&quot;Cspike&quot;</span>)
<span class="kw">show</span>(spike)</code></pre></div>
<pre><code>## An isotope value object of type 'Abundance value': Cspike F 13C [%]
## [1]  5 10 15 20 25</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mb &lt;-<span class="st"> </span><span class="kw">mass_balance</span>(
    <span class="kw">to_ab</span>(res), <span class="co"># convert reservoir to abundance</span>
    <span class="kw">weight</span>(spike, <span class="fl">0.1</span>) <span class="co">#weight spike</span>
)</code></pre></div>
<pre><code>## Successfully found a registered standard to convert delta value: VPDB R 13C/12C: 0.01124</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">show</span>(mb)</code></pre></div>
<pre><code>## A weighted isotope value object of type 'Abundance value': CO2+Cspike F 13C [%]
##      value weight
## 1 1.104119  100.1
## 2 1.109114  100.1
## 3 1.114109  100.1
## 4 1.119104  100.1
## 5 1.124099  100.1</code></pre>
<p>Notice that the result of the mass balance again is a weighted isotope value object itself. It can be converted to other data types or you can keep adding additional components to it with mass balance calculations. In fact, since <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> keeps track of the weight, you can keep tagging multiple mass balances together (the <code>mass_balance()</code> function takes as many parameters as desired). Additionally, since R implements basic arithmetic operators as functions, <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> redefines adding (+) and subtracting (-) for abundance and delta objects to be interpreted as mass balance calculations. This means <code>mass_balance(x, y)</code> is the same as <code>x + y</code> for these isotope value objects. This allows short-hand calculations like the following (although <code>mass_balance()</code> is recommended in more complex situations for clarity of recording what is happening). Here, we are adding a heavy relatively small but heavy pool (40permil, weight=2) to a circumneutral reservoir (5permil, weight=10) and then remove an isotopically light fraction from the pool (-10permil, weight=4).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mb &lt;-<span class="st"> </span>
<span class="st">    </span><span class="kw">delta</span>(<span class="dv">5</span>, <span class="dt">weight =</span> <span class="dv">10</span>) +<span class="st"> </span>
<span class="st">    </span><span class="kw">delta</span>(<span class="dv">40</span>, <span class="dt">weight =</span> <span class="dv">2</span>) -<span class="st"> </span>
<span class="st">    </span><span class="kw">delta</span>(-<span class="dv">10</span>, <span class="dt">weight =</span> <span class="dv">4</span>)
<span class="kw">show</span>(mb)</code></pre></div>
<pre><code>## A weighted isotope value object of type 'Delta value': d13C [permil]
##   value weight
## 1 21.25      8</code></pre>
</div>
<div id="fractionate" class="section level3">
<h3>Fractionate</h3>
<p>During fractionation, a fractionation factor modifies an isotope value object (for example an isotope ratio or a delta value).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="kw">ff</span>(<span class="fl">1.05</span>, <span class="dt">ctop =</span> <span class="st">&quot;DIC&quot;</span>, <span class="dt">cbot =</span> <span class="st">&quot;CO2&quot;</span>, <span class="dt">notation =</span> <span class="st">&quot;alpha&quot;</span>)
r &lt;-<span class="st"> </span><span class="kw">ratio</span>(<span class="fl">0.114</span>, <span class="dt">compound =</span> <span class="st">&quot;CO2&quot;</span>)
r &lt;-<span class="st"> </span><span class="kw">fractionate</span>(a, r)
<span class="kw">show</span>(r)</code></pre></div>
<pre><code>## An isotope value object of type 'Ratio value': DIC R 13C/12C
## [1] 0.1197</code></pre>
<p>Notice that <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> automatically keeps track of what compound is represented. Af- ter fractionation, the ratio represents no longer <span class="math inline">\(CO[2]\)</span> but <span class="math inline">\(DIC\)</span> according to the fractionation factors attributes. If these attributes do not “cancel” correctly, this command fails with an error and the relevant error message. Same as with <code>mass_balance()</code>, <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> implements arithmetic shorthand for this, isotope value objects can be simply fractionationed by multiplying with a fractionation factor. I.e., <code>fractionate(a, b)</code> is the same as <code>a * b</code> (this also means fractionation factors can be easily chained with <code>a1 * a2 * a3 * b</code> but only if the “numerators” and “denominators” cancel properly).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ff</span>(-<span class="dv">25</span>, <span class="dt">notation =</span> <span class="st">&quot;permil&quot;</span>, <span class="dt">ctop =</span> <span class="st">&quot;Corg&quot;</span>, <span class="dt">cbot =</span> <span class="st">&quot;DIC&quot;</span>) *
<span class="st">    </span><span class="kw">ff</span>(-<span class="dv">5</span>, <span class="dt">notation =</span> <span class="st">&quot;permil&quot;</span>, <span class="dt">ctop =</span> <span class="st">&quot;DIC&quot;</span>, <span class="dt">cbot =</span> <span class="st">&quot;CO2&quot;</span>) *<span class="st"> </span>
<span class="st">        </span><span class="kw">delta</span>(<span class="dv">100</span>, <span class="dt">compound =</span> <span class="st">&quot;CO2&quot;</span>)</code></pre></div>
<pre><code>## An isotope value object of type 'Delta value': Corg d13C [permil]
## [1] 67.1375</code></pre>
</div>
<div id="shift-reference" class="section level3">
<h3>Shift reference</h3>
<p>The last operation to introduce for now is shifting a reference frame. This is only defined for <code>delta</code> values and requires the denominator and numerator to cancel (otherwise fails with an error). It is also implemente with the <code>delta * delta</code> arithmetic shorthand. This is a typical scenario useful for processing laboratory data which is measured against a standard of known isotopic composition relative to an international reference.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample &lt;-<span class="st"> </span><span class="kw">delta</span>(-<span class="dv">5</span>, <span class="dt">compound =</span> <span class="st">&quot;sample&quot;</span>, <span class="dt">ref =</span> <span class="st">&quot;my_std&quot;</span>)
standard &lt;-<span class="st"> </span><span class="kw">delta</span>(-<span class="fl">2.5</span>, <span class="dt">compound =</span> <span class="st">&quot;my_std&quot;</span>, <span class="dt">ref =</span> <span class="st">&quot;VPDB&quot;</span>)
<span class="kw">show</span>(<span class="kw">shift_reference</span>(sample, standard))</code></pre></div>
<pre><code>## An isotope value object of type 'Delta value': sample d13C [permil] vs. VPDB
## [1] -7.4875</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">show</span>(sample *<span class="st"> </span>standard)</code></pre></div>
<pre><code>## An isotope value object of type 'Delta value': sample d13C [permil] vs. VPDB
## [1] -7.4875</code></pre>
</div>
<div id="arithmetic" class="section level3">
<h3>Arithmetic</h3>
<p>Several of the arithmetic shorthands were introduced already, but there are several more (for all, see the manual). For all of these, it is always recommend to use the actual real functions in more complex scenarios for clarity. Here’s just an example of what <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> can automatically keep track of in terms of isotope data objects. Here are two ways of turning isotope ratios into a fractionation factor in permil notation - it works booth by explicit mention of each functional step, or by the arithmetic equivalent.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r1 &lt;-<span class="st"> </span><span class="kw">ratio</span>(<span class="fl">0.011</span>)
r2 &lt;-<span class="st"> </span><span class="kw">ratio</span>(<span class="fl">0.0113</span>)
p &lt;-<span class="st"> </span><span class="kw">switch_notation</span>(<span class="kw">to_ff</span>(r1, r2), <span class="st">&quot;permil&quot;</span>)
<span class="kw">show</span>(p)</code></pre></div>
<pre><code>## An isotope value object of type 'FractionationFactor value': 13C eps [permil]
## [1] -26.54867</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span>(r1/r2 -<span class="st"> </span><span class="dv">1</span>) *<span class="st"> </span><span class="dv">1000</span>
<span class="kw">show</span>(p)</code></pre></div>
<pre><code>## An isotope value object of type 'FractionationFactor value': 13C eps [permil]
## [1] -26.54867</code></pre>
</div>
</div>
<div id="testing" class="section level2">
<h2>Testing</h2>
<p>Testing of all functionality in <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> is implemented using the <strong>testthat</strong> module (Wickham, 2011), which provides a simple and uniform way of writing tests that can be run automatically to report any incorrect behaviour immediately. This enables multiple developers to contribute to the core functionality of the project without the risk of breaking prior implementations, but also allows users to easily write a few tests of their own to be confident that the module is doing what it is supposed to be doing, or just to test their own code and formulas on a regular basis. Here are few examples from the many tests already implemented for <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> to give an idea of the range of functionality tests:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(testthat)
<span class="kw">set_iso_opts</span>(<span class="dt">default_ab_notation =</span> <span class="st">&quot;raw&quot;</span>, 
             <span class="dt">default_delta_notation =</span> <span class="st">&quot;permil&quot;</span>, 
             <span class="dt">default_ff_notation =</span> <span class="st">&quot;alpha&quot;</span>)
<span class="kw">expect_error</span>(<span class="kw">ratio</span>(-<span class="fl">0.2</span>), <span class="st">&quot;cannot be negative&quot;</span>)
<span class="kw">expect_false</span>(<span class="kw">is.ratio</span>(<span class="kw">abundance</span>(<span class="fl">0.1</span>)))
<span class="kw">expect_equal</span>(<span class="kw">to_ff</span>(<span class="kw">delta</span>(<span class="dv">200</span>), <span class="kw">delta</span>(-<span class="dv">200</span>)), <span class="kw">ff</span>(<span class="fl">1.2</span> /<span class="st"> </span><span class="fl">0.8</span>))
<span class="kw">expect_is</span>({
        amix &lt;-<span class="st"> </span><span class="kw">abundance</span>(<span class="st">`</span><span class="dt">13C</span><span class="st">`</span> =<span class="st"> </span><span class="fl">0.2</span>, <span class="dt">weight =</span> <span class="dv">2</span>, <span class="dt">compound =</span> <span class="st">&quot;a&quot;</span>) +<span class="st"> </span>
<span class="st">            </span><span class="kw">abundance</span>(<span class="st">`</span><span class="dt">13C</span><span class="st">`</span> =<span class="st"> </span><span class="fl">0.5</span>, <span class="dt">compound =</span> <span class="st">&quot;b&quot;</span>) +<span class="st"> </span>
<span class="st">            </span><span class="kw">abundance</span>(<span class="st">`</span><span class="dt">13C</span><span class="st">`</span> =<span class="st"> </span><span class="fl">0.3</span>, <span class="dt">weight =</span> <span class="dv">3</span>, <span class="dt">compound =</span> <span class="st">&quot;c&quot;</span>)}, <span class="st">&quot;Abundance&quot;</span>)

<span class="kw">expect_equal</span>(<span class="kw">get_label</span>(amix), <span class="st">&quot;a+b+c F 13C&quot;</span>) 
<span class="kw">expect_equal</span>(<span class="kw">get_value</span>(amix), (<span class="fl">0.2</span>*<span class="dv">2</span> +<span class="st"> </span><span class="fl">0.5</span> +<span class="st"> </span><span class="fl">0.3</span>*<span class="dv">3</span>) /<span class="st"> </span>(<span class="dv">2+1+3</span>))
<span class="kw">expect_equal</span>(<span class="kw">get_value</span>(<span class="kw">ff</span>(<span class="fl">0.8</span>) *<span class="st"> </span><span class="kw">delta</span>(<span class="dv">200</span>) +<span class="st"> </span><span class="kw">delta</span>(<span class="dv">100</span>), <span class="st">&quot;permil&quot;</span>), <span class="dv">1000</span>*(<span class="fl">0.8</span>*<span class="fl">1.2</span> -<span class="st"> </span><span class="dv">1</span> +<span class="st"> </span><span class="fl">0.1</span>)/<span class="dv">2</span>)</code></pre></div>
<p>And this is what happens as soon as a test fails (here have to catch the error, otherwise this document would not compile):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tryCatch</span>(
<span class="kw">expect_equal</span>(<span class="kw">fractionate</span>(<span class="kw">ff</span>(<span class="fl">0.995</span>), <span class="kw">delta</span>(<span class="dv">42</span>)), <span class="kw">delta</span>(<span class="dv">42</span>)),
<span class="dt">error =</span> function(e) <span class="kw">message</span>(e$message))</code></pre></div>
<pre><code>## fractionate(ff(0.995), delta(42)) not equal to delta(42)
## 36.8 - 42 == -Inf</code></pre>
</div>
<div id="future-extensions" class="section level2">
<h2>Future extensions</h2>
<p>The <a href="https://github.com/sebkopf/isotopia"><strong>isotopia</strong></a> package currently implements a lot of the core functionality for isotope arithmetic. However, there is much that could built on top of it, including support for mass-scaling and mass-independent data objects and multiply subsituted isotopologues. The goal with all of these would be to provide an interface that can implement rigorous unit tests to ensure calculations are always performed the exact same way, tools to convert between reference frames and make it easier to compare and visualize data in different isotopic spaces, and, above all, to make it fun, intuitive and reproducible to work with isotopic data.</p>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<ul>
<li><a href="http://journal.r-project.org/archive/2011-1/RJournal_2011-1_Wickham.pdf">Wickham, H., 2011. testthat: Get started with testing. The R Journal 3, 5-10.</a></li>
<li><a href="http://cran.r-project.org/package=devtools">Wickham, H., Chang, W., 2014. devtools: Tools to make developing R code easier.</a></li>
<li><a href="http://cran.r-project.org/web/packages/knitr/index.html">Xie, Y., 2013b. knitr: A general-purpose package for dynamic report generation in R.</a></li>
</ul>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
